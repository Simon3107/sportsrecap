{% extends 'base.html' %}
{% block title %}Profil{% endblock %}

{% block content %}
{% if request.user.is_staff %}
  <p>
    <a href="{% url 'admin:index' %}" class="btn btn-warning btn-sm">Adminbereich öffnen</a>
  </p>
{% endif %}

<section class="mb-5">
  <h2 class="section-title">Deine Kommentare</h2>
  <ul class="list-group">
    {% for comment in comments %}
      <li class="list-group-item bg-dark text-white border-secondary mb-2">
        <strong>
          <a href="{% url 'match_detail' comment.match.id %}" class="text-white text-decoration-none">
            {{ comment.match }}
          </a>
        </strong><br>
        <em>{{ comment.created_at|date:"d.m.Y" }}</em><br>
        {{ comment.text }}
      </li>
    {% empty %}
      <li class="list-group-item bg-dark text-white border-secondary">
        Du hast noch keine Kommentare geschrieben.
      </li>
    {% endfor %}
  </ul>
</section>

<section class="mb-5">
  <h2 class="section-title">Deine favorisierten Teams</h2>

  {% for team, matches in team_matches.items %}
    <div class="mb-4">
      <div class="d-flex align-items-center justify-content-between">
        <h3 class="tournament-title mb-2">
          <a href="{% url 'sport_matches' team.sport.id %}?team={{ team.id }}" class="text-white text-decoration-none">
            {{ team.name }}
          </a>
        </h3>
        <form method="post" action="{% url 'toggle_favorite' team.id %}">
          {% csrf_token %}
          <button type="submit" class="btn btn-outline-danger btn-sm">Entfernen</button>
        </form>
      </div>

      {% if team.logo %}
        <a href="{% url 'sport_matches' team.sport.id %}?team={{ team.id }}">
          <img src="{{ team.logo.url }}" alt="{{ team.name }}" height="50" class="mb-2">
        </a>
      {% endif %}

      <div>
        {% if matches %}
          {% for match in matches %}
            <a href="{% url 'match_detail' match.id %}" class="match-row-link">
              <div class="match-row">
                <div class="team team-left">
                  <span>{{ match.team1.name }}</span>
                  <img src="{% if match.team1.logo %}{{ match.team1.logo.url }}{% else %}/media/team_logos/default_logo.png{% endif %}" alt="{{ match.team1.name }}">
                </div>

                <div class="score">{{ match.score }}</div>

                <div class="team team-right">
                  <img src="{% if match.team2.logo %}{{ match.team2.logo.url }}{% else %}/media/team_logos/default_logo.png{% endif %}" alt="{{ match.team2.name }}">
                  <span>{{ match.team2.name }}</span>
                </div>
              </div>
            </a>
            <p class="text-muted mb-4" style="margin-top: -0.5rem;">
              {{ match.match_date|date:"d.m.Y" }} – {{ match.tournament.name }}
            </p>
          {% endfor %}
        {% else %}
          <p class="text-muted">Keine Spiele gefunden.</p>
        {% endif %}
      </div>
    </div>
  {% empty %}
    <p class="text-muted">Du hast noch keine Teams als Favoriten.</p>
  {% endfor %}
</section>
{% endblock %}
